<!DOCTYPE html>

<html lang="pt-BR">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">

		<title>Cartaz de Aniversariantes</title>

		<!-- Place favicon.ico in the root directory -->
		<link rel="apple-touch-icon" href="favicon.ico">

		<!-- Font -->
		<link href="https://fonts.googleapis.com/css2?family=Ubuntu" rel="stylesheet">
		
		<!-- Cookies-->
		<link rel="stylesheet" href="../css/normalize.css">
		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<link rel="stylesheet" href="../css/animate.min.css">
		<link rel="stylesheet" href="../css/bootstrap5.min.css">
        <link rel="stylesheet" href="../css/ads/splide.min.css">
		<link rel="stylesheet" href="../css/style_new.css">

        <style id="aniversariantes">
            .pageTitle {
                text-align: center;
                padding-top: 30px;
                padding-bottom: 20px;
                margin-bottom: 10px;
                border-bottom-left-radius: 8px;
                border-bottom-right-radius: 8px;
            }

            * {
                -webkit-print-color-adjust: exact !important; /*Chrome, Safari */
                print-color-adjust: exact !important;
                color-adjust: exact !important;  /*Firefox*/
            }
                            
        </style>
	</head>

	<body style="overflow-x: hidden; margin-top: -20px; background-color: rgb(245, 245, 245);">

        <div class="container">
            <div class="pageTitle" style="background: #2e2b57; color: #fff">
                <h1>Cartaz de Aniversariantes</h1>
                <h4>Crie o cartaz de aniversariantes do mês preenchendo os campos abaixo</h4>
            </div>
    
            <div class="row">
                <div class="col-sm-6">
                    <div id="formulario" style="border: 1px solid #d4d4d7; border-radius: 8px; background-color: #fff;">
                        <form class="container pt-3">
                            <h3 style="text-align: center; padding-bottom: 20px;">Configurações</h3>
                            <h5>Mês do Cartaz</h5>
                            <label for="month" style="visibility: hidden; display: none">Mês do cartaz</label> 
                            <div id="monthList" class="row" style="padding-bottom: 20px">
                                <div class="col-1">
                                    <input type="radio" name="month" id="1" value="01">
                                    <label for="html">Jan</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="2" value="02">
                                    <label for="html">Fev</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="3" value="03">
                                    <label for="html">Mar</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="4" value="04">
                                    <label for="html">Abr</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="5" value="05">
                                    <label for="html">Mai</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="6" value="06">
                                    <label for="html">Jun</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="7" value="07">
                                    <label for="html">Jul</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="8" value="08">
                                    <label for="html">Ago</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="9" value="09">
                                    <label for="html">Set</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="10" value="10">
                                    <label for="html">Out</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="11" value="11">
                                    <label for="html">Nov</label><br>
                                </div>
                                <div class="col-1">
                                    <input type="radio" name="month" id="12" value="12">
                                    <label for="html">Dez</label><br>
                                </div>
                            </div>
                            <div id="listaAniversariantes">
                                <h5>Aniversariantes</h5>
                                <div class="aniversariante row p-2">
                                    <div class="nomeAniversariante col-auto">
                                        <div class="row">
                                            <div class="col-auto p-1">
                                                <label for="name">
                                                    Nome:
                                                </label>
                                            </div>
                                            <div class="col-auto p-1">
                                                <input name='name' type="text" size="20">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="dataAniversariante col-auto">
                                        <div class="row">
                                            <div class="col-auto" style="padding-left: 12px; padding-right: 0">
                                                <label for="data">
                                                    Data:
                                                </label>
                                            </div>
                                            <div class="col-auto p-0">
                                                <input name="data" type="text" size="1"> / <span class="mesSelecionado"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="excluirElemento col p-0 m-0" style="text-align: right">
                                        <button type="button" class="btn btn-danger excluirAniversariante" tabindex="-1">Excluir</button>
                                    </div>
                                </div>
                            </div>

                            <button id='resetar' type="reset" class="btn btn-danger" style="visibility: hidden; display: none">Reset</button>
                            
                            <div class="row justify-content-between my-0 py-3">
                                <div class="col-auto">
                                    <div class="row">
                                        <div class="col-auto">
                                            <button id='limpar' type="button" class="btn btn-oemar-online" data-bs-toggle="tooltip" data-bs-html="true" data-bs-sanitize="false" data-bs-trigger="click" title="Tem certeza que deseja resetar os dados inseridos? <span id='test'></span><a href='#form' onclick='limparForm()' style='text-color: green'>Sim</a> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <a href='#form' onclick='fecharTooltip()'>Não</a>">Limpar</button>
                                        </div>
                                        <div class="col-auto">
                                            <button id="adicionar" type="button" class="btn btn-oemar-online" onclick="adicionarAniversariante()">Adicionar</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <button type="button" class="btn btn-danger" onclick="gerarCartaz()">Atualizar cartaz</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-sm-6 pt-3 " style="border: 1px solid #d4d4d7; border-radius: 8px; background-color: #fff; margin-bottom: 20px;">
                    <h3 style="text-align: center; padding-bottom: 20px; ">Pré-visualização</h3>
                    <div id="cartaz" style="margin-bottom: 10px">
                        <div style="text-align: center; background: #59acd2; color: #fff;
                        font-family: 'Comic Sans MS', 'Comic Sans', Arial, sans-serif;
                        font-size: 16px;">
                            <img src="../img/utilidades/aniv.webp">
                            <ul id="lista" class="m-0" style="list-style-type: none">

                            </ul>
                            <div id="espaco" style="background: #59acd2; padding-bottom: 30px"> &nbsp; </div>
                        </div>
                        
                    </div>
                    <button type="button" class="btn btn-danger" onclick="imprimirCartaz()" style="text-align: right; margin-bottom: 10px;">Imprimir</button>
                </div>
            </div>
        </div>
        

        <script src="../js/popper.min.js"></script>
		<script src="../js/bootstrap5.min.js"></script>
		<script src="../js/jquery-3.6.0.min.js"></script>
		<script src="../js/ads/splide.min.js"></script>

        <script>
            // inicializar tooltips do bootstrap (botao limpar)
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // colocar html fora da allowlist default nas tooltips
            var myDefaultAllowList = bootstrap.Tooltip.Default.allowList;
            myDefaultAllowList.a = ['onclick', 'href'];


			/* adicionar aniversariante (chamando arquivo)
			$("#adicionar").click(function(){
				$.getScript("adicionarAniversariante.js");
			}); */

            function zeroAntes(n) {
                if(n < 10) {
                    return `0${n}`;
                } else {
                    return n;
                }
            }

            var agora = new Date();
            var mesSelecionado = zeroAntes(agora.getMonth() + 2);

            if(mesSelecionado > 12) {
                mesSelecionado = 1;
            }

			function selecionaMes(mesSelecionado) {
				var agora = new Date();
				var mesAtual = agora.getMonth() + 1;

                if(mesAtual > 12) {
                    mesAtual = 1;
                }

				document.querySelector('#monthList').children[`${mesAtual}`].children[0].setAttribute('checked','checked');

                document.querySelector(".mesSelecionado").innerHTML = zeroAntes(mesAtual+1);
                document.querySelector('#adicionar').setAttribute('onclick',`adicionarAniversariante(${mesSelecionado})`)
			}
			selecionaMes(mesSelecionado);

            function mudaMes(n) {
                document.querySelectorAll('.mesSelecionado').forEach(element => {
                    element.innerHTML = zeroAntes(n);
                });
                document.querySelector('#adicionar').setAttribute('onclick',`adicionarAniversariante(${n})`)
            }

            function botaoExcluir() {
                document.querySelectorAll(".excluirAniversariante").forEach(btn => {
                    btn.addEventListener('mouseup', () => {
                        btn.parentElement.parentElement.remove();
                    })
                });
            }
            botaoExcluir();

            document.addEventListener('DOMContentLoaded', () => {
                document.querySelector("#limpar").click();
                document.querySelector("#test").innerHTML = `
                <button type="submit" class="btn btn-sucess">Sim</button>
                 `;
                 document.querySelector("#limpar").click();
            })

            function limparForm() {
                document.querySelector("button[type=reset]").click();
                document.querySelector("#limpar").click();
            }

            function fecharTooltip() {
                document.querySelector("#limpar").click();
            }

            document.querySelectorAll("input[name='month']").forEach((element) => {
                element.setAttribute("onchange", `mudaMes(${element.value})`);
            });

			function gerarCartaz() {
				// fazer com q leia de arquivo tipo calendario
				// fonte: https://api.jquery.com/serializeArray/
				var input = $(":input").serializeArray();
                
				var i, numeroAniversariantes = input[1].value;

                numeroAniversariantes = input.length;

                var mes = input[0].value;

                document.querySelector("#lista").innerHTML = "";

				for(i = 1; i < numeroAniversariantes; i+=2)
				{
                    let aniversariante = document.createElement('li');

                    aniversariante.style.textAlign = "center";
                    aniversariante.style.backgroundColor = "#59acd2";
                    aniversariante.style.color = "#fff";


                    // o input[0] eh o mes selecionado
                    // o input[2n-1] eh o nome do n-esimo aniversariante
                    // o input[2n] eh a data de aniversario do n-esimo aniversariante
                    aniversariante.innerHTML = `${input[i+1].value}/${input[0].value}`;
                    aniversariante.innerHTML += ` — ${input[i].value}`;
                    

                    document.querySelector("#lista").append(aniversariante);
				}
			}
            
            
			function adicionarAniversariante(mesSelecionado) {
				var input = $(":input").serializeArray();
				var i = 1, j = 0;
				var string = '';
				
				$('#listaAniversariantes').append(`
                    <div class="aniversariante row p-2">
                        <div class="nomeAniversariante col-auto">
                            <div class="row">
                                <div class="col-auto p-1">
                                    <label for="name">
                                        Nome:
                                    </label>
                                </div>
                                <div class="col-auto p-1">
                                    <input name='name' type="text" size="20">
                                </div>
                            </div>
                        </div>
                        <div class="dataAniversariante col-auto">
                            <div class="row">
                                <div class="col-auto" style="padding-left: 12px; padding-right: 0">
                                    <label for="data">
                                        Data:
                                    </label>
                                </div>
                                <div class="col-auto p-0">
                                    <input name='data' type="text" size="1"> / <span class="mesSelecionado">${zeroAntes(mesSelecionado)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="excluirAniversariante col p-0 m-0" style="text-align: right">
                            <button type="button" class="btn btn-danger excluirAniversariante" tabindex="-1">Excluir</button>
                        </div>
                    </div>
                `);

                botaoExcluir();
			}

            function imprimirCartaz() {
                var impressao = document.querySelector("#cartaz").innerHTML;
                var a = window.open('', '', 'height=1000, width=700');
                
                a.document.write(`
                    <html>
                        <head>
                            <style>
                                html {
                                    text-align: center;
                                    background: #59acd2;
                                    color: #fff;
                                    font-family: "Comic Sans MS", "Comic Sans", "Arial", sans-serif;
                                    font-size: 16px;
                                }
                            </style>
                            <style type="text/css" media="print">
                                * {
                                    -webkit-print-color-adjust: exact !important; /*Chrome, Safari */
                                    print-color-adjust: exact !important;
                                    color-adjust: exact !important;  /*Firefox*/
                                }
                            </style>
                        </head>
                        <body>
                `);
                a.document.write(impressao);

                a.print();
                
                let aa = a.document.createElement("script");

                aa.innerHTML = `$(window).load(function() {
                    window.print();
                    window.close();
                });`;

                a.document.append(aa);

                a.print();
                window.close();
            }
		</script>
	</body>
</html>
  